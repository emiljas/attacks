<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <meta charset='utf-8' />
    <link rel="stylesheet" href="highlightjs/styles/default.css" />
    <script src="highlightjs/highlight.pack.js"></script>
    <style>
    main {
      margin: 0 auto;
      width: 1024px;
    }

    #notes .note {
      width: 200px;
    }

    #notes .title {
      font-weight: bold;
    }

    #sqlQuery {
      font-weight: bold;
    }
    </style>
  </head>
  <body>
    <main>
      <h1>Notatki Leny</h1>

      <label>
        szukaj:
        <input id="noteTitle" type="text" autofocus />
      </label>
      <div id="notes"></div>

      <p>
        podglÄ…d zapytania sql:
        <pre><code id="sqlQuery" class="sql"></code></pre>
      </p>
    </main>

    <script>
    var noteTitleInput = document.getElementById("noteTitle")
    var notesDiv = document.getElementById("notes");

    noteTitleInput.addEventListener("input", function(e) {
      var input = e.target.value;
      onInputChanged(input);
    });

    function onInputChanged(input) {
      var req = new XMLHttpRequest();
      req.open("GET", "/test?input=" + encodeURIComponent(input), true);
      req.setRequestHeader('Content-type', 'application/x-www-form-urlencoded; charset=utf-8')
      req.onreadystatechange = function () {
        if (req.readyState == 4) {
          if(req.status == 200)
            var ret= JSON.parse(req.responseText);
            console.log(ret);
            showNotes(ret.notes);
            document.getElementById("sqlQuery").textContent = ret.sqlQuery;
            hljs.highlightBlock(document.getElementById("sqlQuery"));
        }
      };
      req.send(null)
    }

    function showNotes(notes) {
      notesDiv.innerHTML = "";
      notes.forEach(function(note) {
        var noteDiv = document.createElement("div");
        noteDiv.style.backgroundColor = "#" + note.colorRGB;
        noteDiv.className = "note";

        var titleP = document.createElement("p");
        titleP.className = "title";
        titleP.innerHTML = note.title;

        var contentP = document.createElement("p");
        contentP.className = "content";
        contentP.innerHTML = note.content;

        noteDiv.appendChild(titleP);
        noteDiv.appendChild(contentP);

        notesDiv.appendChild(noteDiv);
      });
    }

    onInputChanged("");


    </script>


  </body>
</html>
