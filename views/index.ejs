<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <meta charset='utf-8' />
  </head>
  <body>
    <h1><%= title %></h1>
    <p>Welcome to <%= title %></p>


    <input id="noteTitle" type="text" />

    <div id="notes">

    </div>

    <script>
    var noteTitleInput = document.getElementById("noteTitle")
    var notesDiv = document.getElementById("notes");

    noteTitleInput.addEventListener("input", function(e) {
      var input = e.target.value;
      onInputChanged(input);
    });

    function onInputChanged(input) {
      var req = new XMLHttpRequest();
      req.open("GET", "/test?input=" + encodeURIComponent(input), true);
      req.setRequestHeader('Content-type', 'application/x-www-form-urlencoded; charset=utf-8')
      req.onreadystatechange = function () {
        if (req.readyState == 4) {
          if(req.status == 200)
            var notes = JSON.parse(req.responseText);
            showNotes(notes);
        }
      };
      req.send(null)
    }

    function showNotes(notes) {
      notesDiv.innerHTML = "";
      notes.forEach(function(note) {
        var noteDiv = document.createElement("div");
        noteDiv.innerHTML = note.content;
        notesDiv.appendChild(noteDiv);
      });
    }

    onInputChanged("");


    </script>


  </body>
</html>
